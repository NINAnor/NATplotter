---
title: "testing"
format: html
editor: visual
---

```{r}
library(tidyverse)
```


```{r}
dir <- substr(getwd(), 1,2)

path <- ifelse(dir == "C:", 
               "P:/41001581_egenutvikling_anders_kolstad/data/",
               "/data/Egenutvikling/41001581_egenutvikling_anders_kolstad/data/")
naturtyper <- readRDS(paste0(path, "naturtyper.rds"))
```

```{r}
 summary1 <- naturtyper %>%
    group_by(tilstand) %>%
    summarise(Antall_lokaliteter = n(),
              Areal_km2 = round(sum(km2), 0))
```

```{r}
ggplot(summary1, aes(x = tilstand, y = Antall_lokaliteter))+
      geom_bar(stat="identity",
               fill = "grey80",
               colour = "grey20",
               linewidth=1.5)+
      theme_bw(base_size = 12)
```


```{r}
myvar <- rlang::sym("tilstand")

summary2 <- naturtyper %>%
    group_by(myVar = !!myvar) %>%
    summarise(Antall_lokaliteter = n(),
              Areal_km2 = round(sum(km2), 0))
class(summary2)
```

```{r}
ggplot(summary2, aes_string(x = "myVar", y = "Antall_lokaliteter"))+
      geom_bar(stat="identity",
               fill = "grey80",
               colour = "grey20",
               linewidth=1.5)+
      theme_bw(base_size = 12)
```

```{r}
naturtyper %>%
      filter(naturtype == "Naturbeitemark") %>%
      group_by(kartleggings책r) %>%
      summarise(Antall_lokaliteter = n(),
                Areal_km2 = round(sum(km2), 0)) 
```

```{r}
temp <- dat2_long %>% filter(naturtype == "Naturbeitemark") %>%
  group_by(NiN_variable_code, NiN_variable_value) %>%
      summarise(Antall_lokaliteter = n(),
                Areal_km2 = round(sum(km2), 0))

ggplot(temp, aes(x = NiN_variable_value, y = Antall_lokaliteter))+
  geom_bar(stat="identity",
               fill = "#FF9933",
               colour = "grey20",
               linewidth=1.5)+
      theme_bw(base_size = 12)+
  facet_wrap(.~NiN_variable_code,
             scales = "free",
             ncol = 3)
```


```{r}
ggplot(temp[temp$NiN_variable_code=="PRHA",], aes(x = NiN_variable_value, y = Antall_lokaliteter))+
  geom_bar(stat="identity",
               fill = "#FF9933",
               colour = "grey20",
               linewidth=1.5)+
      theme_bw(base_size = 12)
```


```{r}
temp2 <- temp %>%
  group_by(tilstand) %>%
  summarise(n = n())
```

```{r}
ggplot(temp, aes(x = tilstand, y = n))+
  geom_bar(stat = "identity")
```



```{r}
cond <- TRUE
naturtyper_long_selected_var <- 
   naturtyper_long %>% 
     filter(naturtype == "Naturbeitemark") %>%
     filter(NiN_variable_code == "PRRL-EN") %>%
     group_by(NiN_variable_code, NiN_variable_value) %>%
     { if (cond) group_by(., kartleggings책r, .add=T) else . } %>%
     summarise(Antall_lokaliteter = n(),
               Areal_km2 = round(sum(km2), 0))
```

```{r}
ggplot(naturtyper_long_selected_var, aes(x = NiN_variable_value, y = Antall_lokaliteter))+
    geom_bar(stat="identity",
             fill = "#FF9933",
             colour = "grey20",
             linewidth=1.5)+
    theme_bw(base_size = myBase_size) +
  facet_grid(vars(kartleggings책r))
```

```{r}
x1 <- "kartleggings책r"
x2 <- "7FA"
```


```{r}
temp <- naturtyper_long %>%
  filter(naturtype == "Naturbeitemark") %>%
  { if( !x1 %in% varList2) {
     filter(., NiN_variable_code == x2) %>%
     pivot_wider(., id_cols = identifikasjon_lokalid,
                                       names_from = NiN_variable_code,
                                       values_from = NiN_variable_value)
  } else { select(., identifikasjon_lokalid, km2, x1) %>%
      distinct(., identifikasjon_lokalid, .keep_all = T)}}


temp2 <- naturtyper_long %>%
  filter(naturtype == "Naturbeitemark") %>%
  { if( !x2 %in% varList2) {
     filter(., NiN_variable_code == x2) %>%
     pivot_wider(., id_cols = identifikasjon_lokalid,
                                       names_from = NiN_variable_code,
                                       values_from = NiN_variable_value)
  } else { select(., identifikasjon_lokalid, x1) %>%
      distinct(., identifikasjon_lokalid) }}

temp_out <- full_join(temp, temp2, by = "identifikasjon_lokalid")
temp_out <- temp_out %>%
  rename("first_variable" = 3,
         "second_variable" = 4)

temp_out <- temp_out %>%
  group_by(first_variable, second_variable) %>%
  summarise(Antall_lokaliteter = n(),
            Areal_km2 = round(sum(km2), 0))

```



```{r}
ggplot(temp_out, aes(x = first_variable, y = Antall_lokaliteter))+
    geom_bar(stat="identity",
             fill = "#FFCC99",
             colour = "grey20",
             linewidth=1.5)+
    theme_bw(base_size = 20) +
  facet_wrap(.~second_variable)
```





















